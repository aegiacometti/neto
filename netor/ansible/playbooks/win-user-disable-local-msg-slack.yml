# usage example: ansible-playbook win-user-disable-local.yml --extra-vars "user=user_name server=server channel=channel_name"
---
- name: Win disable user playbook Local
  hosts: '{{ server }}'
  gather_facts: false
  tasks:

    - name: Check connection to Server
      wait_for_connection:
        connect_timeout: 3
        timeout: 5
      register: connection
      ignore_errors: yes

    - name: Message to slack if connection failed
      local_action: command python3 scripts/win-user-connection-failed-msg-slack.py "{{ connection }}" "{{ channel }}" "{{ user }}"

    - name: Win disable user Local
      win_user:
        name: '{{ user }}'
        account_disabled: yes
      register: output
      ignore_errors: yes

    - name: Send message to Slack using a python script
      local_action: command python3 scripts/win-user-disable-msg-slack.py "{{ output }}" "{{ channel }}"